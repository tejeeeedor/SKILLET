<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Skillet Store</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Estilos generales */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #0a0a0a;
            color: #f0f0f0;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header de Checkout */
        .checkout-header {
            background: linear-gradient(rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.9)), 
                        url('https://i.scdn.co/image/ab67616d0000b2735d3963ed253465edbed6f7d1');
            background-size: cover;
            background-position: center;
            padding: 30px 0;
            text-align: center;
            border-bottom: 3px solid #e10600;
        }
        
        .checkout-header h1 {
            font-size: 2.5rem;
            color: #e10600;
            margin-bottom: 10px;
        }
        
        .checkout-header p {
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .progress-bar {
            display: flex;
            justify-content: center;
            margin-top: 30px;
            gap: 40px;
        }
        
        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        
        .step-circle {
            width: 40px;
            height: 40px;
            background-color: #333;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 10px;
            transition: all 0.3s;
            border: 2px solid #333;
        }
        
        .step-circle.active {
            background-color: #e10600;
            border-color: #e10600;
        }
        
        .step-circle.completed {
            background-color: #00a8ff;
            border-color: #00a8ff;
        }
        
        .step-label {
            font-size: 0.9rem;
            color: #aaa;
        }
        
        .step-label.active {
            color: #e10600;
            font-weight: bold;
        }
        
        .step-label.completed {
            color: #00a8ff;
        }
        
        .progress-line {
            position: absolute;
            top: 20px;
            left: 50px;
            width: 80px;
            height: 2px;
            background-color: #333;
            z-index: -1;
        }
        
        /* Contenedor principal de Checkout */
        .checkout-container {
            display: flex;
            gap: 40px;
            margin: 40px 0;
            flex-wrap: wrap;
        }
        
        .checkout-form {
            flex: 1;
            min-width: 300px;
        }
        
        .order-summary {
            width: 350px;
            background-color: #111;
            border-radius: 10px;
            padding: 25px;
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        /* Formularios */
        .checkout-step {
            background-color: #111;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 20px;
            display: none;
        }
        
        .checkout-step.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .step-title {
            color: #e10600;
            font-size: 1.5rem;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #f0f0f0;
            font-weight: 500;
        }
        
        .input-with-icon {
            position: relative;
        }
        
        .input-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #777;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            background-color: #1a1a1a;
            border: 1px solid #333;
            border-radius: 5px;
            color: #f0f0f0;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #e10600;
            box-shadow: 0 0 0 2px rgba(225, 6, 0, 0.2);
        }
        
        input.with-icon {
            padding-left: 45px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .checkbox-group input {
            width: auto;
        }
        
        /* Métodos de pago */
        .payment-methods {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .payment-method {
            flex: 1;
            min-width: 150px;
        }
        
        .payment-method input {
            display: none;
        }
        
        .payment-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background-color: #1a1a1a;
            border: 2px solid #333;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .payment-label:hover {
            border-color: #444;
        }
        
        .payment-label.selected {
            border-color: #e10600;
            background-color: rgba(225, 6, 0, 0.05);
        }
        
        .payment-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        /* Tarjeta de crédito */
        .card-details {
            display: none;
            margin-top: 20px;
            animation: fadeIn 0.5s ease;
        }
        
        .card-details.active {
            display: block;
        }
        
        .card-preview {
            background: linear-gradient(135deg, #2c3e50, #4a6491);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            color: white;
            position: relative;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .card-chip {
            width: 50px;
            height: 40px;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .card-number {
            font-size: 1.5rem;
            letter-spacing: 3px;
            margin-bottom: 20px;
            font-family: monospace;
        }
        
        .card-info {
            display: flex;
            justify-content: space-between;
        }
        
        .card-expiry, .card-cvc {
            display: flex;
            flex-direction: column;
        }
        
        .card-expiry span:first-child, .card-cvc span:first-child {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        /* Resumen del pedido */
        .order-summary h3 {
            color: #e10600;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
        }
        
        .order-items {
            margin-bottom: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .order-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #222;
        }
        
        .order-item:last-child {
            border-bottom: none;
        }
        
        .item-name {
            flex: 1;
        }
        
        .item-price {
            color: #e10600;
            font-weight: bold;
        }
        
        .order-totals {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #333;
        }
        
        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .total-row.grand-total {
            font-size: 1.2rem;
            font-weight: bold;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #333;
        }
        
        /* Botones de navegación */
        .checkout-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #333;
        }
        
        .btn {
            display: inline-block;
            background-color: #e10600;
            color: white;
            padding: 12px 30px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .btn:hover {
            background-color: #b30500;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(225, 6, 0, 0.4);
        }
        
        .btn-outline {
            background-color: transparent;
            border: 2px solid #333;
            color: #f0f0f0;
        }
        
        .btn-outline:hover {
            background-color: #333;
            transform: translateY(-3px);
        }
        
        .btn-full {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
        }
        
        /* === NUEVO: ESTILOS PARA LA PASARELA DE PAGO === */
        .payment-gateway-step {
            background-color: #111;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 20px;
            display: none;
        }
        
        .payment-gateway-step.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .gateway-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #333;
        }
        
        .gateway-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .secure-badge {
            background-color: #00a8ff;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .payment-amount-display {
            text-align: center;
            margin: 40px 0;
        }
        
        .amount-label {
            color: #aaa;
            font-size: 1rem;
            margin-bottom: 10px;
        }
        
        .amount-value {
            font-size: 3rem;
            color: #e10600;
            font-weight: bold;
        }
        
        .gateway-steps {
            display: flex;
            justify-content: space-between;
            margin: 40px 0;
            position: relative;
        }
        
        .gateway-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 2;
            flex: 1;
        }
        
        .gateway-step-number {
            width: 40px;
            height: 40px;
            background-color: #333;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            font-weight: bold;
            transition: all 0.3s;
            border: 2px solid #333;
        }
        
        .gateway-step-number.active {
            background-color: #e10600;
            border-color: #e10600;
        }
        
        .gateway-step-number.completed {
            background-color: #00a8ff;
            border-color: #00a8ff;
        }
        
        .gateway-step-label {
            font-size: 0.9rem;
            color: #aaa;
            text-align: center;
        }
        
        .gateway-step-label.active {
            color: #e10600;
            font-weight: bold;
        }
        
        .gateway-step-label.completed {
            color: #00a8ff;
        }
        
        .gateway-steps-line {
            position: absolute;
            top: 20px;
            left: 50px;
            right: 50px;
            height: 2px;
            background-color: #333;
            z-index: 1;
        }
        
        .gateway-content {
            min-height: 300px;
        }
        
        .bank-selection-container {
            margin: 20px 0;
        }
        
        .bank-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 25px 0;
        }
        
        .bank-option {
            background-color: #1a1a1a;
            border: 2px solid #333;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .bank-option:hover {
            border-color: #444;
            transform: translateY(-3px);
        }
        
        .bank-option.selected {
            border-color: #e10600;
            background-color: rgba(225, 6, 0, 0.05);
        }
        
        .bank-logo {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .bank-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .verification-container {
            text-align: center;
            padding: 30px 0;
        }
        
        .verification-icon {
            font-size: 4rem;
            color: #00a8ff;
            margin-bottom: 20px;
        }
        
        .processing-container {
            text-align: center;
            padding: 40px 20px;
        }
        
        .processing-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(225, 6, 0, 0.1);
            border-top: 4px solid #e10600;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        .processing-details {
            color: #777;
            font-size: 0.9rem;
            margin-top: 20px;
            text-align: left;
            max-width: 300px;
            margin: 20px auto;
        }
        
        .completion-container {
            text-align: center;
            padding: 40px 20px;
        }
        
        .completion-icon {
            font-size: 5rem;
            color: #00a8ff;
            margin-bottom: 20px;
        }
        
        .completion-title {
            font-size: 2rem;
            color: #00a8ff;
            margin-bottom: 15px;
        }
        
        .transaction-details {
            background-color: #1a1a1a;
            border-radius: 10px;
            padding: 25px;
            margin: 30px 0;
            text-align: left;
        }
        
        .transaction-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
        }
        
        .transaction-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
            font-weight: bold;
            color: #e10600;
        }
        
        /* === FIN ESTILOS PASARELA === */
        
        /* Modal de confirmación */
        .confirmation-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .confirmation-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .confirmation-content {
            background-color: #111;
            border-radius: 15px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            transform: translateY(20px);
            transition: transform 0.3s;
        }
        
        .confirmation-modal.active .confirmation-content {
            transform: translateY(0);
        }
        
        .confirmation-icon {
            font-size: 4rem;
            color: #00a8ff;
            margin-bottom: 20px;
        }
        
        .confirmation-content h2 {
            color: #00a8ff;
            margin-bottom: 15px;
        }
        
        .confirmation-content p {
            margin-bottom: 25px;
            color: #aaa;
        }
        
        .order-details {
            background-color: #1a1a1a;
            border-radius: 10px;
            padding: 20px;
            margin: 25px 0;
            text-align: left;
        }
        
        .order-details div {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }
        
        .order-details div:last-child {
            margin-bottom: 0;
            font-weight: bold;
            color: #e10600;
        }
        
        /* Animaciones */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .checkout-container {
                flex-direction: column;
            }
            
            .order-summary {
                width: 100%;
                position: static;
            }
            
            .progress-bar {
                gap: 20px;
            }
            
            .progress-line {
                width: 40px;
                left: 30px;
            }
            
            .bank-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 576px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .payment-methods {
                flex-direction: column;
            }
            
            .checkout-step, .payment-gateway-step {
                padding: 20px;
            }
            
            .bank-grid {
                grid-template-columns: 1fr;
            }
            
            .gateway-steps {
                flex-direction: column;
                gap: 30px;
            }
            
            .gateway-steps-line {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Header de Checkout -->
    <header class="checkout-header">
        <div class="container">
            <h1>Finalizar Compra</h1>
            <p>Completa los siguientes pasos para finalizar tu pedido</p>
            
            <!-- Barra de progreso -->
            <div class="progress-bar">
                <div class="progress-step">
                    <div class="step-circle active" id="step1">1</div>
                    <div class="step-label active">Envío</div>
                    <div class="progress-line"></div>
                </div>
                <div class="progress-step">
                    <div class="step-circle" id="step2">2</div>
                    <div class="step-label">Pago</div>
                    <div class="progress-line"></div>
                </div>
                <div class="progress-step">
                    <div class="step-circle" id="step3">3</div>
                    <div class="step-label">Confirmación</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Contenedor principal -->
    <div class="container">
        <div class="checkout-container">
            <!-- Formulario de checkout -->
            <div class="checkout-form">
                <!-- Paso 1: Información de envío -->
                <div class="checkout-step active" id="stepShipping">
                    <h2 class="step-title">Información de Envío</h2>
                    
                    <form id="shippingForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="firstName">Nombre *</label>
                                <div class="input-with-icon">
                                    <i class="fas fa-user input-icon"></i>
                                    <input type="text" id="firstName" class="with-icon" required placeholder="Juan">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="lastName">Apellidos *</label>
                                <div class="input-with-icon">
                                    <i class="fas fa-user input-icon"></i>
                                    <input type="text" id="lastName" class="with-icon" required placeholder="García">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="email">Correo Electrónico *</label>
                            <div class="input-with-icon">
                                <i class="fas fa-envelope input-icon"></i>
                                <input type="email" id="email" class="with-icon" required placeholder="tu@email.com">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="phone">Teléfono *</label>
                            <div class="input-with-icon">
                                <i class="fas fa-phone input-icon"></i>
                                <input type="tel" id="phone" class="with-icon" required placeholder="+34 612 345 678">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="address">Dirección *</label>
                            <div class="input-with-icon">
                                <i class="fas fa-home input-icon"></i>
                                <input type="text" id="address" class="with-icon" required placeholder="Calle Principal 123">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="city">Ciudad *</label>
                                <input type="text" id="city" required placeholder="Madrid">
                            </div>
                            <div class="form-group">
                                <label for="zipCode">Código Postal *</label>
                                <input type="text" id="zipCode" required placeholder="28001">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="country">País *</label>
                            <select id="country" required>
                                <option value="">Seleccionar país</option>
                                <option value="ES" selected>España</option>
                                <option value="FR">Francia</option>
                                <option value="DE">Alemania</option>
                                <option value="IT">Italia</option>
                                <option value="UK">Reino Unido</option>
                                <option value="US">Estados Unidos</option>
                                <option value="MX">México</option>
                                <option value="AR">Argentina</option>
                            </select>
                        </div>
                        
                        <div class="checkbox-group">
                            <input type="checkbox" id="saveAddress">
                            <label for="saveAddress">Guardar esta dirección para futuras compras</label>
                        </div>
                        
                        <div class="checkbox-group">
                            <input type="checkbox" id="billingSame" checked>
                            <label for="billingSame">La dirección de facturación es la misma que la de envío</label>
                        </div>
                    </form>
                </div>
                
                <!-- Paso 2: Método de pago -->
                <div class="checkout-step" id="stepPayment">
                    <h2 class="step-title">Método de Pago</h2>
                    
                    <div class="payment-methods">
                        <div class="payment-method">
                            <input type="radio" id="creditCard" name="paymentMethod" value="creditCard" checked>
                            <label class="payment-label selected" for="creditCard">
                                <i class="fas fa-credit-card payment-icon"></i>
                                <span>Tarjeta de Crédito</span>
                            </label>
                        </div>
                        
                        <div class="payment-method">
                            <input type="radio" id="paypal" name="paymentMethod" value="paypal">
                            <label class="payment-label" for="paypal">
                                <i class="fab fa-paypal payment-icon"></i>
                                <span>PayPal</span>
                            </label>
                        </div>
                        
                        <div class="payment-method">
                            <input type="radio" id="bankTransfer" name="paymentMethod" value="bankTransfer">
                            <label class="payment-label" for="bankTransfer">
                                <i class="fas fa-university payment-icon"></i>
                                <span>Transferencia Bancaria</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Detalles de tarjeta de crédito -->
                    <div class="card-details active" id="cardDetails">
                        <!-- Vista previa de tarjeta -->
                        <div class="card-preview">
                            <div class="card-chip"></div>
                            <div class="card-number" id="cardPreviewNumber">**** **** **** ****</div>
                            <div class="card-info">
                                <div class="card-expiry">
                                    <span>VALID THRU</span>
                                    <span id="cardPreviewExpiry">MM/YY</span>
                                </div>
                                <div class="card-cvc">
                                    <span>CVC</span>
                                    <span id="cardPreviewCVC">***</span>
                                </div>
                            </div>
                        </div>
                        
                        <form id="cardForm">
                            <div class="form-group">
                                <label for="cardNumber">Número de Tarjeta *</label>
                                <div class="input-with-icon">
                                    <i class="fas fa-credit-card input-icon"></i>
                                    <input type="text" id="cardNumber" class="with-icon" maxlength="19" placeholder="1234 5678 9012 3456" required>
                                </div>
                                <div class="card-icons" style="margin-top: 5px; display: flex; gap: 10px;">
                                    <i class="fab fa-cc-visa" style="color: #1a1f71;"></i>
                                    <i class="fab fa-cc-mastercard" style="color: #eb001b;"></i>
                                    <i class="fab fa-cc-amex" style="color: #2e77bc;"></i>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="cardExpiry">Fecha de Expiración *</label>
                                    <input type="text" id="cardExpiry" maxlength="5" placeholder="MM/AA" required>
                                </div>
                                <div class="form-group">
                                    <label for="cardCVC">CVC *</label>
                                    <div class="input-with-icon">
                                        <input type="text" id="cardCVC" maxlength="4" placeholder="123" required>
                                        <i class="fas fa-lock input-icon" style="left: auto; right: 15px;"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="cardName">Nombre en la Tarjeta *</label>
                                <input type="text" id="cardName" placeholder="JUAN GARCIA" required>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="saveCard" checked>
                                <label for="saveCard">Guardar esta tarjeta para futuras compras</label>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Detalles de PayPal (oculto inicialmente) -->
                    <div class="card-details" id="paypalDetails">
                        <p style="margin-bottom: 20px;">Serás redirigido a PayPal para completar el pago de forma segura.</p>
                        <button class="btn btn-full" onclick="processPayPal()">
                            <i class="fab fa-paypal"></i> Continuar con PayPal
                        </button>
                    </div>
                    
                    <!-- Detalles de transferencia bancaria (oculto inicialmente) -->
                    <div class="card-details" id="bankTransferDetails">
                        <p style="margin-bottom: 15px;">Realiza una transferencia a nuestra cuenta bancaria:</p>
                        <div style="background-color: #1a1a1a; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <div style="margin-bottom: 10px;">
                                <strong>Banco:</strong> Banco Skillet Oficial
                            </div>
                            <div style="margin-bottom: 10px;">
                                <strong>IBAN:</strong> ES12 3456 7890 1234 5678 9012
                            </div>
                            <div style="margin-bottom: 10px;">
                                <strong>BIC/SWIFT:</strong> BSKLXXX
                            </div>
                            <div>
                                <strong>Concepto:</strong> Pedido #<span id="orderNumber">SKL-2023-001</span>
                            </div>
                        </div>
                        <p style="color: #aaa; font-size: 0.9rem;">
                            Una vez realizada la transferencia, enviaremos un correo de confirmación. El envío se procesará una vez recibido el pago (1-2 días hábiles).
                        </p>
                    </div>
                </div>
                
                <!-- Paso 3: Confirmación -->
                <div class="checkout-step" id="stepConfirmation">
                    <h2 class="step-title">Confirmación del Pedido</h2>
                    
                    <div style="text-align: center; margin-bottom: 30px;">
                        <i class="fas fa-shopping-bag" style="font-size: 4rem; color: #e10600; margin-bottom: 20px;"></i>
                        <h3 style="margin-bottom: 15px;">¡Estás a punto de completar tu compra!</h3>
                        <p>Revisa los detalles de tu pedido antes de confirmar.</p>
                    </div>
                    
                    <div style="background-color: #1a1a1a; border-radius: 10px; padding: 25px; margin-bottom: 25px;">
                        <h4 style="margin-bottom: 15px; color: #e10600;">Resumen del Pedido</h4>
                        <div id="confirmationItems"></div>
                        
                        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #333;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Subtotal:</span>
                                <span id="confirmationSubtotal">$0.00</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Envío:</span>
                                <span id="confirmationShipping">$5.99</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Impuestos:</span>
                                <span id="confirmationTax">$0.00</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 1.2rem; color: #e10600;">
                                <span>Total:</span>
                                <span id="confirmationTotal">$0.00</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background-color: #1a1a1a; border-radius: 10px; padding: 25px;">
                        <h4 style="margin-bottom: 15px; color: #e10600;">Información de Envío</h4>
                        <div id="confirmationShippingInfo"></div>
                    </div>
                    
                    <div class="checkbox-group" style="margin-top: 25px;">
                        <input type="checkbox" id="terms" required>
                        <label for="terms">Acepto los <a href="#" style="color: #e10600;">Términos y Condiciones</a> y la <a href="#" style="color: #e10600;">Política de Privacidad</a> *</label>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="newsletter" checked>
                        <label for="newsletter">Suscribirme al newsletter de Skillet para recibir ofertas exclusivas</label>
                    </div>
                </div>
                
                <!-- === NUEVO: PASO 4 - PASARELA DE PAGO === -->
                <div class="payment-gateway-step" id="stepPaymentGateway">
                    <!-- Encabezado de la pasarela -->
                    <div class="gateway-header">
                        <div class="gateway-logo">
                            <i class="fas fa-shield-alt"></i>
                            <span>SecurePay</span>
                        </div>
                        <div class="secure-badge">
                            <i class="fas fa-lock"></i> 100% Seguro
                        </div>
                        <div style="color: #aaa; font-size: 0.9rem;">
                            Orden: <span id="gatewayOrderId">SKL-2023-001</span>
                        </div>
                    </div>
                    
                    <!-- Monto del pago -->
                    <div class="payment-amount-display">
                        <div class="amount-label">Total a pagar</div>
                        <div class="amount-value">
                            $<span id="gatewayAmount">0.00</span>
                        </div>
                    </div>
                    
                    <!-- Pasos de la pasarela -->
                    <div class="gateway-steps">
                        <div class="gateway-steps-line"></div>
                        
                        <div class="gateway-step">
                            <div class="gateway-step-number active" id="gatewayStep1">1</div>
                            <div class="gateway-step-label active">Banco</div>
                        </div>
                        
                        <div class="gateway-step">
                            <div class="gateway-step-number" id="gatewayStep2">2</div>
                            <div class="gateway-step-label">Autenticación</div>
                        </div>
                        
                        <div class="gateway-step">
                            <div class="gateway-step-number" id="gatewayStep3">3</div>
                            <div class="gateway-step-label">Procesando</div>
                        </div>
                        
                        <div class="gateway-step">
                            <div class="gateway-step-number" id="gatewayStep4">4</div>
                            <div class="gateway-step-label">Completado</div>
                        </div>
                    </div>
                    
                    <!-- Contenido dinámico de la pasarela -->
                    <div class="gateway-content" id="gatewayContent">
                        <!-- Se carga dinámicamente -->
                    </div>
                </div>
                
                <!-- Navegación entre pasos -->
                <div class="checkout-navigation">
                    <button class="btn btn-outline" id="prevBtn" onclick="previousStep()" style="display: none;">
                        <i class="fas fa-arrow-left"></i> Anterior
                    </button>
                    <button class="btn" id="nextBtn" onclick="nextStep()">
                        Continuar <i class="fas fa-arrow-right"></i>
                    </button>
                    <button class="btn" id="confirmBtn" onclick="confirmOrder()" style="display: none;">
                        <i class="fas fa-lock"></i> Confirmar y Pagar
                    </button>
                </div>
            </div>
            
            <!-- Resumen del pedido -->
            <div class="order-summary">
                <h3>Tu Pedido</h3>
                
                <div class="order-items" id="orderItems">
                    <!-- Los productos del carrito se cargarán aquí -->
                </div>
                
                <div class="order-totals">
                    <div class="total-row">
                        <span>Subtotal</span>
                        <span id="summarySubtotal">$0.00</span>
                    </div>
                    <div class="total-row">
                        <span>Envío</span>
                        <span id="summaryShipping">$5.99</span>
                    </div>
                    <div class="total-row">
                        <span>Impuestos</span>
                        <span id="summaryTax">$0.00</span>
                    </div>
                    <div class="total-row grand-total">
                        <span>Total</span>
                        <span id="summaryTotal">$0.00</span>
                    </div>
                </div>
                
                <div style="margin-top: 25px; padding-top: 25px; border-top: 1px solid #333;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <i class="fas fa-shield-alt" style="color: #00a8ff; font-size: 1.5rem;"></i>
                        <div>
                            <div style="font-weight: bold;">Compra 100% segura</div>
                            <div style="font-size: 0.9rem; color: #aaa;">Datos encriptados SSL</div>
                        </div>
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <i class="fas fa-truck" style="color: #00a8ff; font-size: 1.5rem;"></i>
                        <div>
                            <div style="font-weight: bold;">Envío en 24-48h</div>
                            <div style="font-size: 0.9rem; color: #aaa;">España peninsular</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de confirmación -->
    <div class="confirmation-modal" id="confirmationModal">
        <div class="confirmation-content">
            <div class="confirmation-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h2>¡Pedido Confirmado!</h2>
            <p>Tu pedido ha sido procesado con éxito. Te hemos enviado un correo de confirmación con todos los detalles.</p>
            
            <div class="order-details">
                <div>
                    <span>Número de pedido:</span>
                    <span id="orderId">SKL-2023-<span id="randomOrder">001</span></span>
                </div>
                <div>
                    <span>Fecha:</span>
                    <span id="orderDate"></span>
                </div>
                <div>
                    <span>Método de pago:</span>
                    <span id="orderPaymentMethod"></span>
                </div>
                <div>
                    <span>Total pagado:</span>
                    <span id="orderTotalPaid">$0.00</span>
                </div>
            </div>
            
            <p style="margin-top: 20px; font-size: 0.9rem; color: #aaa;">
                Recibirás un correo de seguimiento cuando tu pedido sea enviado.
            </p>
            
            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <button class="btn btn-outline" onclick="closeConfirmation()">
                    Seguir Comprando
                </button>
                <button class="btn" onclick="viewOrderDetails()">
                    Ver Detalles
                </button>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let currentStep = 1;
        let cartItems = [];
        let shippingCost = 5.99;
        let taxRate = 0.21;
        
        // Variables para la pasarela de pago
        let gatewayStep = 1;
        let selectedBank = null;
        
        // Inicializar cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', function() {
            loadCartItems();
            setupPaymentMethods();
            setupCardPreview();
            loadOrderSummary();
            
            // Generar número de pedido aleatorio
            document.getElementById('randomOrder').textContent = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            
            // Establecer fecha actual
            const now = new Date();
            document.getElementById('orderDate').textContent = now.toLocaleDateString('es-ES', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        });
        
        // Cargar items del carrito desde localStorage
        function loadCartItems() {
            const savedCart = localStorage.getItem('skilletCart');
            if (savedCart) {
                cartItems = JSON.parse(savedCart);
            } else {
                // Datos de ejemplo si no hay carrito
                cartItems = [
                    { name: 'Vinilo "Awake" (180g Negro)', price: 32.99, quantity: 1 },
                    { name: 'Camiseta "Monster" Tour 2024', price: 24.99, quantity: 2 },
                    { name: 'Pack Stickers Premium', price: 9.99, quantity: 1 }
                ];
            }
        }
        
        // Cargar resumen del pedido
        function loadOrderSummary() {
            const orderItems = document.getElementById('orderItems');
            const confirmationItems = document.getElementById('confirmationItems');
            let subtotal = 0;
            
            orderItems.innerHTML = '';
            confirmationItems.innerHTML = '';
            
            cartItems.forEach(item => {
                const itemTotal = item.price * (item.quantity || 1);
                subtotal += itemTotal;
                
                // Para el resumen lateral
                const orderItem = document.createElement('div');
                orderItem.className = 'order-item';
                orderItem.innerHTML = `
                    <div class="item-name">${item.name} <span style="color: #777; font-size: 0.9rem;">x${item.quantity || 1}</span></div>
                    <div class="item-price">$${itemTotal.toFixed(2)}</div>
                `;
                orderItems.appendChild(orderItem);
                
                // Para la confirmación
                const confirmationItem = document.createElement('div');
                confirmationItem.style.display = 'flex';
                confirmationItem.style.justifyContent = 'space-between';
                confirmationItem.style.marginBottom = '10px';
                confirmationItem.innerHTML = `
                    <span>${item.name} x${item.quantity || 1}</span>
                    <span>$${itemTotal.toFixed(2)}</span>
                `;
                confirmationItems.appendChild(confirmationItem);
            });
            
            const tax = subtotal * taxRate;
            const total = subtotal + shippingCost + tax;
            
            // Actualizar resumen lateral
            document.getElementById('summarySubtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('summaryTax').textContent = `$${tax.toFixed(2)}`;
            document.getElementById('summaryTotal').textContent = `$${total.toFixed(2)}`;
            
            // Actualizar confirmación
            document.getElementById('confirmationSubtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('confirmationTax').textContent = `$${tax.toFixed(2)}`;
            document.getElementById('confirmationTotal').textContent = `$${total.toFixed(2)}`;
            document.getElementById('orderTotalPaid').textContent = `$${total.toFixed(2)}`;
        }
        
        // Configurar métodos de pago
        function setupPaymentMethods() {
            const paymentMethods = document.querySelectorAll('input[name="paymentMethod"]');
            const cardDetails = document.getElementById('cardDetails');
            const paypalDetails = document.getElementById('paypalDetails');
            const bankTransferDetails = document.getElementById('bankTransferDetails');
            
            paymentMethods.forEach(method => {
                method.addEventListener('change', function() {
                    // Actualizar estilos visuales
                    document.querySelectorAll('.payment-label').forEach(label => {
                        label.classList.remove('selected');
                    });
                    this.nextElementSibling.classList.add('selected');
                    
                    // Mostrar/ocultar detalles según método
                    cardDetails.classList.remove('active');
                    paypalDetails.classList.remove('active');
                    bankTransferDetails.classList.remove('active');
                    
                    if (this.value === 'creditCard') {
                        cardDetails.classList.add('active');
                        document.getElementById('confirmBtn').innerHTML = '<i class="fas fa-lock"></i> Confirmar y Pagar';
                    } else if (this.value === 'paypal') {
                        paypalDetails.classList.add('active');
                        document.getElementById('confirmBtn').innerHTML = '<i class="fab fa-paypal"></i> Pagar con PayPal';
                    } else if (this.value === 'bankTransfer') {
                        bankTransferDetails.classList.add('active');
                        document.getElementById('confirmBtn').innerHTML = '<i class="fas fa-university"></i> Confirmar Pedido';
                    }
                });
            });
        }
        
        // Configurar vista previa de tarjeta
        function setupCardPreview() {
            const cardNumber = document.getElementById('cardNumber');
            const cardExpiry = document.getElementById('cardExpiry');
            const cardCVC = document.getElementById('cardCVC');
            
            cardNumber.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                value = value.replace(/(\d{4})(?=\d)/g, '$1 ');
                e.target.value = value.substring(0, 19);
                
                // Actualizar vista previa
                const preview = value.replace(/\d(?=\d{4})/g, '*');
                document.getElementById('cardPreviewNumber').textContent = preview || '**** **** **** ****';
            });
            
            cardExpiry.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length >= 2) {
                    value = value.substring(0, 2) + '/' + value.substring(2, 4);
                }
                e.target.value = value.substring(0, 5);
                document.getElementById('cardPreviewExpiry').textContent = value || 'MM/YY';
            });
            
            cardCVC.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                e.target.value = value.substring(0, 4);
                document.getElementById('cardPreviewCVC').textContent = value.replace(/\d/g, '*') || '***';
            });
        }
        
        // Navegación entre pasos del checkout
        function nextStep() {
            if (currentStep === 1) {
                if (!validateShippingForm()) return;
                loadShippingInfo();
            } else if (currentStep === 2) {
                const selectedMethod = document.querySelector('input[name="paymentMethod"]:checked').value;
                if (selectedMethod === 'creditCard' && !validateCardForm()) return;
            }
            
            // Ocultar paso actual
            document.getElementById(`step${currentStep === 1 ? 'Shipping' : currentStep === 2 ? 'Payment' : 'Confirmation'}`).classList.remove('active');
            
            // Actualizar barra de progreso
            document.getElementById(`step${currentStep}`).classList.remove('active');
            document.getElementById(`step${currentStep}`).classList.add('completed');
            
            currentStep++;
            
            // Actualizar barra de progreso
            document.getElementById(`step${currentStep}`).classList.add('active');
            
            // Mostrar siguiente paso
            document.getElementById(`step${currentStep === 2 ? 'Payment' : 'Confirmation'}`).classList.add('active');
            
            // Actualizar botones de navegación
            updateNavigationButtons();
        }
        
        function previousStep() {
            if (currentStep === 4) {
                // Si estamos en la pasarela, volver a confirmación
                document.getElementById('stepPaymentGateway').classList.remove('active');
                document.getElementById('stepConfirmation').classList.add('active');
                currentStep = 3;
                
                // Actualizar botones
                document.getElementById('prevBtn').style.display = 'inline-block';
                document.getElementById('nextBtn').style.display = 'none';
                document.getElementById('confirmBtn').style.display = 'inline-block';
                return;
            }
            
            // Ocultar paso actual
            document.getElementById(`step${currentStep === 2 ? 'Payment' : 'Confirmation'}`).classList.remove('active');
            
            // Actualizar barra de progreso
            document.getElementById(`step${currentStep}`).classList.remove('active');
            
            currentStep--;
            
            // Actualizar barra de progreso
            document.getElementById(`step${currentStep}`).classList.add('active');
            document.getElementById(`step${currentStep + 1}`).classList.remove('completed');
            
            // Mostrar paso anterior
            document.getElementById(`step${currentStep === 1 ? 'Shipping' : 'Payment'}`).classList.add('active');
            
            // Actualizar botones de navegación
            updateNavigationButtons();
        }
        
        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const confirmBtn = document.getElementById('confirmBtn');
            
            if (currentStep === 1) {
                prevBtn.style.display = 'none';
                nextBtn.style.display = 'inline-block';
                confirmBtn.style.display = 'none';
                nextBtn.innerHTML = 'Continuar <i class="fas fa-arrow-right"></i>';
            } else if (currentStep === 2) {
                prevBtn.style.display = 'inline-block';
                nextBtn.style.display = 'inline-block';
                confirmBtn.style.display = 'none';
                nextBtn.innerHTML = 'Continuar <i class="fas fa-arrow-right"></i>';
            } else if (currentStep === 3) {
                prevBtn.style.display = 'inline-block';
                nextBtn.style.display = 'none';
                confirmBtn.style.display = 'inline-block';
                
                // Actualizar texto del botón según método de pago
                const selectedMethod = document.querySelector('input[name="paymentMethod"]:checked').value;
                if (selectedMethod === 'creditCard') {
                    confirmBtn.innerHTML = '<i class="fas fa-lock"></i> Confirmar y Pagar';
                } else if (selectedMethod === 'paypal') {
                    confirmBtn.innerHTML = '<i class="fab fa-paypal"></i> Pagar con PayPal';
                } else {
                    confirmBtn.innerHTML = '<i class="fas fa-university"></i> Confirmar Pedido';
                }
            }
        }
        
        // Validación de formularios
        function validateShippingForm() {
            const requiredFields = ['firstName', 'lastName', 'email', 'phone', 'address', 'city', 'zipCode', 'country'];
            let isValid = true;
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    field.style.borderColor = '#e10600';
                    isValid = false;
                    
                    // Remover el error cuando el usuario empiece a escribir
                    field.addEventListener('input', function() {
                        this.style.borderColor = '#333';
                    }, { once: true });
                }
            });
            
            // Validación de email
            const email = document.getElementById('email');
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (email.value && !emailRegex.test(email.value)) {
                email.style.borderColor = '#e10600';
                alert('Por favor, introduce un email válido.');
                isValid = false;
            }
            
            if (!isValid) {
                alert('Por favor, completa todos los campos obligatorios (*)');
            }
            
            return isValid;
        }
        
        function validateCardForm() {
            const cardNumber = document.getElementById('cardNumber').value.replace(/\s/g, '');
            const cardExpiry = document.getElementById('cardExpiry').value;
            const cardCVC = document.getElementById('cardCVC').value;
            const cardName = document.getElementById('cardName').value;
            
            if (!cardNumber || cardNumber.length < 16) {
                alert('Por favor, introduce un número de tarjeta válido (16 dígitos)');
                return false;
            }
            
            if (!cardExpiry || !/^\d{2}\/\d{2}$/.test(cardExpiry)) {
                alert('Por favor, introduce una fecha de expiración válida (MM/AA)');
                return false;
            }
            
            if (!cardCVC || cardCVC.length < 3) {
                alert('Por favor, introduce un código CVC válido (3-4 dígitos)');
                return false;
            }
            
            if (!cardName) {
                alert('Por favor, introduce el nombre que aparece en la tarjeta');
                return false;
            }
            
            return true;
        }
        
        // Cargar información de envío para confirmación
        function loadShippingInfo() {
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const address = document.getElementById('address').value;
            const city = document.getElementById('city').value;
            const zipCode = document.getElementById('zipCode').value;
            const country = document.getElementById('country').value;
            
            const countryNames = {
                'ES': 'España',
                'FR': 'Francia',
                'DE': 'Alemania',
                'IT': 'Italia',
                'UK': 'Reino Unido',
                'US': 'Estados Unidos',
                'MX': 'México',
                'AR': 'Argentina'
            };
            
            document.getElementById('confirmationShippingInfo').innerHTML = `
                <div style="margin-bottom: 5px;"><strong>${firstName} ${lastName}</strong></div>
                <div style="margin-bottom: 5px;">${address}</div>
                <div style="margin-bottom: 5px;">${zipCode} ${city}</div>
                <div>${countryNames[country] || country}</div>
            `;
        }
        
        // Procesar pago con PayPal
        function processPayPal() {
            // Simulación de redirección a PayPal
            alert('Redirigiendo a PayPal...\n\nEn una implementación real, esto redirigiría a la página de pago de PayPal.');
            startPaymentGateway();
        }
        
        // === NUEVAS FUNCIONES PARA LA PASARELA DE PAGO ===
        
        // Iniciar pasarela de pago
        function confirmOrder() {
            if (!document.getElementById('terms').checked) {
                alert('Debes aceptar los Términos y Condiciones para continuar.');
                return;
            }
            
            // Ocultar paso de confirmación
            document.getElementById('stepConfirmation').classList.remove('active');
            document.getElementById('step3').classList.remove('active');
            
            // Mostrar pasarela de pago
            document.getElementById('stepPaymentGateway').classList.add('active');
            
            // Actualizar botones de navegación
            document.getElementById('prevBtn').style.display = 'inline-block';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('confirmBtn').style.display = 'none';
            
            // Inicializar pasarela
            initializePaymentGateway();
        }
        
        // Inicializar la pasarela
        function initializePaymentGateway() {
            const total = parseFloat(document.getElementById('confirmationTotal').textContent.replace('$', ''));
            const orderId = `SKL-${new Date().getFullYear()}-${Math.floor(Math.random() * 10000).toString().padStart(4, '0')}`;
            
            // Configurar datos de la pasarela
            document.getElementById('gatewayAmount').textContent = total.toFixed(2);
            document.getElementById('gatewayOrderId').textContent = orderId;
            
            // Reiniciar pasos de la pasarela
            gatewayStep = 1;
            selectedBank = null;
            
            // Mostrar selección de banco
            showBankSelection();
        }
        
        // Mostrar selección de bancos
        function showBankSelection() {
            const gatewayContent = document.getElementById('gatewayContent');
            
            gatewayContent.innerHTML = `
                <h3 style="margin-bottom: 20px; color: #e10600;">Selecciona tu banco</h3>
                <p style="color: #aaa; margin-bottom: 25px;">Elige tu entidad bancaria para continuar con el pago seguro.</p>
                
                <div class="bank-selection-container">
                    <div class="bank-grid">
                        <div class="bank-option" onclick="selectGatewayBank('bbva')">
                            <div class="bank-logo" style="color: #004481;">
                                <i class="fas fa-university"></i>
                            </div>
                            <div class="bank-name">BBVA</div>
                            <div style="font-size: 0.8rem; color: #777;">Transferencia segura</div>
                        </div>
                        
                        <div class="bank-option" onclick="selectGatewayBank('santander')">
                            <div class="bank-logo" style="color: #ec0000;">
                                <i class="fas fa-landmark"></i>
                            </div>
                            <div class="bank-name">Santander</div>
                            <div style="font-size: 0.8rem; color: #777;">Transferencia segura</div>
                        </div>
                        
                        <div class="bank-option" onclick="selectGatewayBank('caixa')">
                            <div class="bank-logo" style="color: #0066a1;">
                                <i class="fas fa-piggy-bank"></i>
                            </div>
                            <div class="bank-name">CaixaBank</div>
                            <div style="font-size: 0.8rem; color: #777;">Transferencia segura</div>
                        </div>
                        
                        <div class="bank-option" onclick="selectGatewayBank('sabadell')">
                            <div class="bank-logo" style="color: #00a0e3;">
                                <i class="fas fa-building"></i>
                            </div>
                            <div class="bank-name">Sabadell</div>
                            <div style="font-size: 0.8rem; color: #777;">Transferencia segura</div>
                        </div>
                        
                        <div class="bank-option" onclick="selectGatewayBank('ing')">
                            <div class="bank-logo" style="color: #ff6200;">
                                <i class="fas fa-leaf"></i>
                            </div>
                            <div class="bank-name">ING</div>
                            <div style="font-size: 0.8rem; color: #777;">Transferencia segura</div>
                        </div>
                        
                        <div class="bank-option" onclick="selectGatewayBank('kutxa')">
                            <div class="bank-logo" style="color: #00b2a9;">
                                <i class="fas fa-hand-holding-usd"></i>
                            </div>
                            <div class="bank-name">Kutxabank</div>
                            <div style="font-size: 0.8rem; color: #777;">Transferencia segura</div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <button class="btn btn-full" onclick="nextGatewayStep()" id="nextGatewayBtn" disabled>
                        <i class="fas fa-lock"></i> Continuar con el pago
                    </button>
                </div>
                
                <div style="margin-top: 20px; text-align: center;">
                    <button class="btn btn-outline" onclick="cancelGatewayPayment()" style="padding: 10px 20px;">
                        <i class="fas fa-times"></i> Cancelar pago
                    </button>
                </div>
            `;
        }
        
        // Seleccionar banco en la pasarela
        function selectGatewayBank(bankId) {
            // Deseleccionar todos los bancos
            document.querySelectorAll('.bank-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Seleccionar el banco clickeado
            const selectedOption = document.querySelector(`[onclick="selectGatewayBank('${bankId}')"]`);
            if (selectedOption) {
                selectedOption.classList.add('selected');
                
                // Guardar banco seleccionado
                const bankNames = {
                    'bbva': 'BBVA',
                    'santander': 'Santander',
                    'caixa': 'CaixaBank',
                    'sabadell': 'Sabadell',
                    'ing': 'ING',
                    'kutxa': 'Kutxabank'
                };
                selectedBank = {
                    id: bankId,
                    name: bankNames[bankId] || bankId
                };
                
                // Habilitar botón de continuar
                document.getElementById('nextGatewayBtn').disabled = false;
            }
        }
        
        // Avanzar al siguiente paso de la pasarela
        function nextGatewayStep() {
            if (gatewayStep === 1 && !selectedBank) {
                alert('Por favor, selecciona un banco para continuar.');
                return;
            }
            
            // Actualizar paso actual
            document.getElementById(`gatewayStep${gatewayStep}`).classList.remove('active');
            document.getElementById(`gatewayStep${gatewayStep}`).classList.add('completed');
            
            gatewayStep++;
            
            // Actualizar paso nuevo
            document.getElementById(`gatewayStep${gatewayStep}`).classList.add('active');
            
            // Mostrar contenido según el paso
            if (gatewayStep === 2) {
                showAuthenticationStep();
            } else if (gatewayStep === 3) {
                showProcessingStep();
                simulatePaymentProcessing();
            } else if (gatewayStep === 4) {
                showCompletionStep();
            }
        }
        
        // Mostrar paso de autenticación
        function showAuthenticationStep() {
            const gatewayContent = document.getElementById('gatewayContent');
            
            gatewayContent.innerHTML = `
                <div class="verification-container">
                    <div class="verification-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h3 style="margin-bottom: 20px; color: #00a8ff;">Autenticación requerida</h3>
                    <p style="color: #aaa; margin-bottom: 30px; line-height: 1.8;">
                        Serás redirigido a la página de <strong style="color: #00a8ff;">${selectedBank.name}</strong> 
                        para verificar tu identidad.<br>
                        Este proceso es necesario para garantizar la seguridad de tu pago.
                    </p>
                    
                    <div style="background-color: #1a1a1a; border-radius: 10px; padding: 20px; margin: 30px 0;">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <i class="fas fa-lock" style="color: #00a8ff; font-size: 1.5rem;"></i>
                            <div>
                                <div style="font-weight: bold;">Conexión segura activada</div>
                                <div style="font-size: 0.9rem; color: #aaa;">Tus datos están encriptados</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <i class="fas fa-user-shield" style="color: #00a8ff; font-size: 1.5rem;"></i>
                            <div>
                                <div style="font-weight: bold;">Autenticación bancaria</div>
                                <div style="font-size: 0.9rem; color: #aaa;">Verificación de identidad requerida</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <button class="btn btn-full" onclick="simulateBankRedirect()">
                        <i class="fas fa-external-link-alt"></i> Continuar al banco
                    </button>
                </div>
                
                <div style="margin-top: 20px; text-align: center;">
                    <button class="btn btn-outline" onclick="previousGatewayStep()" style="padding: 10px 20px;">
                        <i class="fas fa-arrow-left"></i> Volver
                    </button>
                </div>
            `;
        }
        
        // Simular redirección al banco
        function simulateBankRedirect() {
            const btn = document.querySelector('.btn-full');
            const originalText = btn.innerHTML;
            
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Redirigiendo...';
            btn.disabled = true;
            
            setTimeout(() => {
                nextGatewayStep();
                
                // Restaurar botón
                btn.innerHTML = originalText;
                btn.disabled = false;
            }, 2000);
        }
        
        // Mostrar paso de procesamiento
        function showProcessingStep() {
            const gatewayContent = document.getElementById('gatewayContent');
            
            gatewayContent.innerHTML = `
                <div class="processing-container">
                    <div class="processing-spinner"></div>
                    <h3 style="margin-bottom: 15px; color: #e10600;">Procesando tu pago</h3>
                    <p style="color: #aaa; margin-bottom: 20px;">
                        Estamos verificando y procesando tu transacción.<br>
                        Por favor, no cierres esta ventana.
                    </p>
                    
                    <div class="processing-details">
                        <div style="margin-bottom: 10px;">
                            <i class="fas fa-circle" style="color: #e10600; font-size: 0.6rem; margin-right: 10px; animation: pulse 1.5s infinite;"></i>
                            <span>Conectando con ${selectedBank.name}...</span>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <i class="fas fa-circle" style="color: #e10600; font-size: 0.6rem; margin-right: 10px; animation: pulse 1.5s infinite; animation-delay: 0.3s;"></i>
                            <span>Verificando fondos...</span>
                        </div>
                        <div>
                            <i class="fas fa-circle" style="color: #e10600; font-size: 0.6rem; margin-right: 10px; animation: pulse 1.5s infinite; animation-delay: 0.6s;"></i>
                            <span>Confirmando transacción...</span>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Simular procesamiento del pago
        function simulatePaymentProcessing() {
            setTimeout(() => {
                nextGatewayStep();
            }, 5000);
        }
        
        // Mostrar paso de finalización
        function showCompletionStep() {
            const total = document.getElementById('gatewayAmount').textContent;
            const orderId = document.getElementById('gatewayOrderId').textContent;
            const transactionId = `TXN-${Date.now().toString().slice(-8)}`;
            const now = new Date();
            const dateStr = now.toLocaleDateString('es-ES', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            const gatewayContent = document.getElementById('gatewayContent');
            
            gatewayContent.innerHTML = `
                <div class="completion-container">
                    <div class="completion-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h2 class="completion-title">¡Pago Completado!</h2>
                    <p style="color: #aaa; margin-bottom: 30px; line-height: 1.8;">
                        Tu transacción ha sido procesada exitosamente.<br>
                        Hemos enviado un comprobante a tu correo electrónico.
                    </p>
                    
                    <div class="transaction-details">
                        <div class="transaction-row">
                            <span>Número de transacción:</span>
                            <span>${transactionId}</span>
                        </div>
                        <div class="transaction-row">
                            <span>Fecha y hora:</span>
                            <span>${dateStr}</span>
                        </div>
                        <div class="transaction-row">
                            <span>Método de pago:</span>
                            <span>Transferencia - ${selectedBank.name}</span>
                        </div>
                        <div class="transaction-row">
                            <span>Banco:</span>
                            <span>${selectedBank.name}</span>
                        </div>
                        <div class="transaction-row">
                            <span>Total pagado:</span>
                            <span>$${total}</span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 40px;">
                        <button class="btn btn-full" onclick="finishGatewayPayment()">
                            <i class="fas fa-home"></i> Volver a la tienda
                        </button>
                    </div>
                </div>
            `;
        }
        
        // Volver al paso anterior en la pasarela
        function previousGatewayStep() {
            if (gatewayStep > 1) {
                // Actualizar paso actual
                document.getElementById(`gatewayStep${gatewayStep}`).classList.remove('active');
                document.getElementById(`gatewayStep${gatewayStep}`).classList.remove('completed');
                
                gatewayStep--;
                
                // Actualizar paso anterior
                document.getElementById(`gatewayStep${gatewayStep}`).classList.add('active');
                document.getElementById(`gatewayStep${gatewayStep}`).classList.remove('completed');
                
                // Mostrar contenido según el paso
                if (gatewayStep === 1) {
                    showBankSelection();
                } else if (gatewayStep === 2) {
                    showAuthenticationStep();
                }
            }
        }
        
        // Cancelar pago en la pasarela
        function cancelGatewayPayment() {
            if (confirm('¿Estás seguro de que quieres cancelar el pago? Todos los datos se perderán.')) {
                // Volver al paso de confirmación
                document.getElementById('stepPaymentGateway').classList.remove('active');
                document.getElementById('stepConfirmation').classList.add('active');
                
                // Actualizar bot